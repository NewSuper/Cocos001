{"version":3,"sources":["assets\\scripts\\Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class Player extends cc.Component {\n  @property\n  jumpHeight: number = 0;\n\n  @property\n  jumpDuration: number = 0;\n\n  @property\n  squashDuration: number = 0;\n\n  @property\n  maxMoveSpeed: number = 0;\n\n  @property\n  accel: number = 0;\n\n  @property(cc.AudioClip)\n  jumpAudio: cc.AudioClip = null;\n\n  jumpAction: cc.ActionInstant;\n  accLeft: boolean;\n  accRight: boolean;\n  xSpeed: number;\n\n  onLoad() {\n    this.enabled = false;\n\n    // 初始化跳跃动作\n    this.jumpAction = this.setJumpAction();\n\n    // 加速度方向开关\n    this.accLeft = false;\n    this.accRight = false;\n    // 主角当前水平方向速度\n    this.xSpeed = 0;\n\n    // 初始化键盘输入监听\n    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n\n    var touchReceiver = cc.Canvas.instance.node;\n    touchReceiver.on(\"touchstart\", this.onTouchStart, this);\n    touchReceiver.on(\"touchend\", this.onTouchEnd, this);\n  }\n\n  start() {}\n\n  startMoveAt(pos: cc.Vec2) {\n    this.enabled = true;\n    this.xSpeed = 0;\n    this.node.setPosition(pos);\n    this.node.runAction(this.setJumpAction());\n  }\n\n  update(dt) {\n    // 根据当前加速度方向每帧更新速度\n    if (this.accLeft) {\n      this.xSpeed -= this.accel * dt;\n    } else if (this.accRight) {\n      this.xSpeed += this.accel * dt;\n    }\n    // 限制主角的速度不能超过最大值\n    if (Math.abs(this.xSpeed) > this.maxMoveSpeed) {\n      // if speed reach limit, use max speed with current direction\n      this.xSpeed = (this.maxMoveSpeed * this.xSpeed) / Math.abs(this.xSpeed);\n    }\n    if (!this.accLeft && !this.accRight) {\n      //速度不断衰减\n      this.xSpeed = this.xSpeed * 0.99;\n    }\n\n    // 根据当前速度更新主角的位置\n    this.node.x += this.xSpeed * dt;\n\n    // limit player position inside screen\n    if (this.node.x > this.node.parent.width / 2) {\n      this.node.x = this.node.parent.width / 2;\n      //反向\n      this.xSpeed = -this.xSpeed;\n    } else if (this.node.x < -this.node.parent.width / 2) {\n      this.node.x = -this.node.parent.width / 2;\n      this.xSpeed = -this.xSpeed;\n    }\n  }\n\n  setJumpAction() {\n    // 跳跃上升\n    let jumpUp = cc\n      .moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight))\n      .easing(cc.easeCubicActionOut());\n    // 下落\n    let jumpDown = cc\n      .moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight))\n      .easing(cc.easeCubicActionIn());\n    // 形变\n    let squash = cc.scaleTo(this.squashDuration, 1, 0.6);\n    let stretch = cc.scaleTo(this.squashDuration, 1, 1.2);\n    let scaleBack = cc.scaleTo(this.squashDuration, 1, 1);\n    // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法\n    let callback = cc.callFunc(this.playJumpSound, this);\n    // 不断重复，而且每次完成落地动作后调用回调来播放声音\n    return cc.repeatForever(\n      cc.sequence(squash, stretch, jumpUp, scaleBack, jumpDown, callback)\n    );\n  }\n\n  playJumpSound() {\n    // 调用声音引擎播放声音\n    cc.audioEngine.playEffect(this.jumpAudio, false);\n  }\n\n  onKeyDown(event: cc.Event.EventKeyboard) {\n    // set a flag when key pressed\n    switch (event.keyCode) {\n      case cc.macro.KEY.a:\n      case cc.macro.KEY.left:\n        this.accLeft = true;\n        break;\n      case cc.macro.KEY.d:\n      case cc.macro.KEY.right:\n        this.accRight = true;\n        break;\n    }\n  }\n\n  onKeyUp(event: cc.Event.EventKeyboard) {\n    // unset a flag when key released\n    switch (event.keyCode) {\n      case cc.macro.KEY.a:\n      case cc.macro.KEY.left:\n        this.accLeft = false;\n        break;\n      case cc.macro.KEY.d:\n      case cc.macro.KEY.right:\n        this.accRight = false;\n        break;\n    }\n  }\n\n  onDestroy() {\n    // 取消键盘输入监听\n    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n    cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\n\n    var touchReceiver = cc.Canvas.instance.node;\n    touchReceiver.off(\"touchstart\", this.onTouchStart, this);\n    touchReceiver.off(\"touchend\", this.onTouchEnd, this);\n  }\n\n  onTouchStart(event) {\n    var touchLoc = event.getLocation();\n    if (touchLoc.x >= cc.winSize.width / 2) {\n      this.accLeft = false;\n      this.accRight = true;\n    } else {\n      this.accLeft = true;\n      this.accRight = false;\n    }\n  }\n\n  onTouchEnd(event) {\n    this.accLeft = false;\n    this.accRight = false;\n  }\n}\n"]}