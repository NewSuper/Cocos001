{"version":3,"sources":["assets\\scripts\\Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Player from \"./Player\";\nimport ScoreAnimator from \"./ScoreAnimator\";\nimport Star from \"./Star\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class GameManager extends cc.Component {\n  @property(cc.Prefab)\n  starPrefab: cc.Prefab = null;\n\n  @property(cc.Prefab)\n  animRootPrefab: cc.Prefab = null;\n\n  @property\n  maxStarDuration = 0;\n\n  @property\n  minStarDuration = 0;\n\n  @property(cc.Node)\n  ground: cc.Node = null;\n\n  @property(cc.Node)\n  player: cc.Node = null;\n\n  @property(cc.Node)\n  btnNode: cc.Node = null;\n\n  @property(cc.Node)\n  gameOverNode: cc.Node = null;\n\n  @property(cc.Label)\n  scoreDisplay: cc.Label = null;\n\n  @property(cc.AudioClip)\n  scoreAudio: cc.AudioClip = null;\n\n  private groundY: number = 0;\n  private currentStar: cc.Node = null;\n  private currentAnimRoot: cc.Node = null;\n  timer: number = 0;\n  starDuration: number = 0;\n  starPool: cc.NodePool;\n  scorePool: cc.NodePool;\n  score: number;\n\n  onLoad() {\n    // 获取地平面的 y 轴坐标\n    this.groundY = this.ground.y + this.ground.height / 2;\n\n    // store last star's x position\n    this.currentStar = null;\n    this.currentAnimRoot = null;\n\n    // 初始化计时器\n    this.timer = 0;\n    this.starDuration = 0;\n\n    // is showing menu or running game\n    this.enabled = false;\n\n    // initialize star and score pool\n    this.starPool = new cc.NodePool(\"Star\");\n    this.scorePool = new cc.NodePool(\"ScoreAnim\");\n  }\n\n  start() {}\n\n  // update (dt) {}\n\n  onStartGame() {\n    // 初始化计分\n    this.score = 0;\n    this.scoreDisplay.string = \"Score: \" + this.score.toString();\n    // set game state to running\n    this.enabled = true;\n    // set button and gameover text out of screen\n    this.btnNode.x = 3000;\n    // \"Game Over\" not visible\n    this.gameOverNode.active = false;\n    // reset player position and move speed\n    this.player.getComponent(Player).startMoveAt(cc.v2(0, this.groundY));\n    // spawn star\n    this.spawnNewStar();\n  }\n\n  spawnNewStar() {\n    let newStar = null;\n    // 使用给定的模板在场景中生成一个新节点\n    if (this.starPool.size() > 0) {\n      newStar = this.starPool.get(this); // this will be passed to Star's reuse method\n    } else {\n      newStar = cc.instantiate(this.starPrefab);\n      // pass Game instance to star\n      newStar.getComponent(Star).reuse(this);\n    }\n    // 为星星设置一个随机位置\n    newStar.setPosition(this.getNewStarPosition());\n    // 将新增的节点添加到 Canvas 节点下面\n    this.node.addChild(newStar);\n\n    // 重置计时器，根据消失时间范围随机取一个值\n    this.starDuration =\n      this.minStarDuration +\n      Math.random() * (this.maxStarDuration - this.minStarDuration);\n    this.timer = 0;\n\n    this.currentStar = newStar;\n  }\n\n  getNewStarPosition() {\n    let randX = 0;\n    // 根据地平面位置和主角跳跃高度，随机得到一个星星的 y 坐标\n    let randY =\n      this.groundY +\n      Math.random() * this.player.getComponent(Player).jumpHeight +\n      50;\n    // 根据屏幕宽度，随机得到一个星星 x 坐标\n    let maxX = this.node.width / 2;\n    randX = (Math.random() - 0.5) * 2 * maxX;\n    // 返回星星坐标\n    return cc.v2(randX, randY);\n  }\n\n  despawnStar(star: cc.Node) {\n    this.starPool.put(star);\n    this.spawnNewStar();\n  }\n\n  spawnAnimRoot() {\n    let fx;\n    if (this.scorePool.size() > 0) {\n      fx = this.scorePool.get(this);\n    } else {\n      fx = cc.instantiate(this.animRootPrefab);\n      fx.getComponent(ScoreAnimator).reuse(this);\n    }\n    return fx;\n  }\n\n  despawnAnimRoot() {\n    this.scorePool.put(this.currentAnimRoot);\n  }\n\n  gameOver() {\n    this.gameOverNode.active = true;\n    this.btnNode.x = 0;\n    this.player.getComponent(Player).enabled = false;\n    this.player.stopAllActions(); //停止 player 节点的跳跃动作\n    this.currentStar.destroy();\n  }\n\n  protected update(dt: number): void {\n    // 每帧更新计时器，超过限度还没有生成新的星星\n    // 就会调用游戏失败逻辑\n    if (this.timer > this.starDuration) {\n      this.gameOver();\n      this.enabled = false; // disable gameOver logic to avoid load scene repeatedly\n      return;\n    }\n    this.timer += dt;\n  }\n\n  gainScore(pos: cc.Vec3) {\n    this.score += 1;\n    // 更新 scoreDisplay Label 的文字\n    this.scoreDisplay.string = \"Score: \" + this.score;\n    // 播放特效\n    this.currentAnimRoot = this.spawnAnimRoot();\n    this.node.addChild(this.currentAnimRoot);\n    this.currentAnimRoot.position = pos;\n    this.currentAnimRoot.getComponent(cc.Animation).play(\"score_pop\");\n    // 播放得分音效\n    cc.audioEngine.playEffect(this.scoreAudio, false);\n  }\n}\n"]}